 % -*- root: ../thesis.tex -*-
\chapter{Characterizing linear-optical networks via PhaseLift}%
\label{chap:phaselift}


\todo{The physics part needs work}


Linear-optical networks composed of beamsplitting and phaseshifting operations are fundamental to the quantum and classical processing of information with light.
Passive and reconfigurable linear optical circuits have been proposed and demonstrated for many applications including telecommunications~\cite{Miller_2015_Sorting}, machine learning~\cite{Shen_2017_Deep} and quantum computation~\cite{Carolan_2015_Universal} and simulation~\cite{Harris_2017_Quantum}.
With the continuing development of large-scale integrated photonic platforms~\cite{Silverstone_2016_Silicon,Seok_2016_LargeScale}, practical and reliable techniques for characterising and validating the operation of these devices are crucial.
In this work, we present new protocols for characterising linear optical devices with low experimental resources by exploiting a connection to the phase retrieval problem \cite{Walther_1963_Question}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
\subsection{Linear Optics}

Theoretically, a linear optical device is fully characterized by its \emph{transfer matrix} ${M}$.
We consider as input to the device classical light described by a multimode coherent state $\ket{{\alpha}} = \ket{\alpha_1, \ldots, \alpha_n}$.
Due to the linearity of the device, this input is mapped to a coherent state $\ket{{\beta}}$ in the output via
\[
  \beta_j = \sum_k M_{j,k} \,\alpha_k.
  \label{eq:pl.coherent_transfer_matrix}
\]
Determining ${M}$ experimentally is the crucial step to validate and verify an existing linear optical circuit.
The standard measurable quantities in an optical experiment are the \emph{intensities} of the output modes
\[
  I_j({\alpha})
  = \left| \beta_j \right|^2 + \epsilon_j
  = \left| \sum_k M_{j,k} \, \alpha_k \right|^2 + \epsilon_j
  \label{eq:pl.intensities}
\]
for certain coherent inputs $\ket{{\alpha}}$.
Here, $\epsilon_j$ describes noise due to statistical fluctuations or systematic errors.
Although the output coherent states~\eqref{eq:pl.coherent_transfer_matrix} are linear in ${M}$, the resulting intensity measurements~\eqref{eq:pl.intensities} are quadratic in ${M}$ and oblivious to the phases of $\beta$.
Therefore, the problem of reconstructing ${M}$ from such measurements is ill-posed and requires deliberate utilization of inference between the modes to recover the phases of $M$.

Well-known techniques for fully characterising photonic circuits include quantum process tomography with non-classical~\cite{Brien_2004_Quantum} or coherent~\cite{Keshari_2011_Quantum} states, though these approaches scale exponentially with the number of modes.
Simpler protocols tailored to linear optics have been proposed that use either single and two-photon probe states~\cite{Laing_2012_SuperStable,Dhand_2016_Accurate,Spagnolo_2017_Learning} or multimode coherent states~\cite{Keshari_2013_Direct,Tillmann_2016_On}.
The most similar scheme to the one presented here is~\cite{Keshari_2013_Direct}, where coherent light is input into single modes and split over pairs of modes with the intensity at each output measured.
While their recovery method is strikingly simple and relies only on $2n-1$ input configurations, for each configuration it requires varying over a phase shift between the two modes until maximal constructive interference is observed.
Furthermore, by construction, it propagates information about ${M}$'s first row to the remaining ones.
The first requirement results in an interactive experiment, where the inputs need to be adjusted gradually throughout an individual measurement.
\todo{Not quite correct.}
Moreover, the second feature of the recovery protocol makes it a priori susceptible towards noise as any error in the determination of the first row propagates to the remaining rows.



\subsection{Phase Retrieval}

The crucial observation of this work is that measurements~\eqref{eq:pl.intensities} closely resemble the model of the \textit{phase retrieval problem}, i.e.\ the problem of recovering a complex vector ${x} \in \Complex^n$ from $m$ intensity measurements of the form
\[
  y\ind{l}= \Abs{\braket{\alpha\ind{l}, x}} + \epsilon\ind{l}
  \quad l=1,\ldots,m.
  \label{eq:pl.phase_retrieval_measurements}
\]
Here, $\alpha^{(l)} \in \Complex^n$ denote measurement vectors and $\epsilon^{(l)}$ the additive measurement errors.
The major difficulty in recovering $x$ from these intensity measurements is the loss of phase information.
In order to infer the phase information, we need to exploit interference effects by carefully selecting different measurement vectors.
However, $x$ can only be recovered up to a global phase since $x$ and $\exp^{\ii\phi} x$ are indistinguishable from the measurements~\eqref{eq:pl.phase_retrieval_measurements} for any argument $\phi$.

One practical solution to the phase retrieval problem is based on its connection to the field of low-rank matrix recovery.
The quadratic measurements of $x$ in \cref{eq:pl.phase_retrieval_measurements} can be rewritten as
\[
  \left| \langle {x}, \alpha^{(l)} \rangle \right|^2
  = \tr \left( (\ket{\alpha^{(l)}}\bra{\alpha^{(l)}}) (\ket{{x}}\bra{{x}}) \right).
\]
This \quotes{lifts} the phase retrieval problem to the problem of recovering the positive semi-definite (psd) rank-1 matrix $\ketbra{x}$ from linear measurements.
The latter -- and its generalization to arbitrary low-rank matrices -- have been studied extensively in the field of \emph{low-rank matrix recovery}, see e.g.~\cite{Ahmed_2014_Blind,Candes_2009_Exact,Candes_2011_Tight,Recht_2010_Guaranteed,Gross_2011_Recovering,Chen_2015_IncoherenceOptimal} for a highly incomplete list of references.

The fundamental idea is to find the matrix $Z$ with the smallest rank that is compatible with the observations.
As an example, consider the idealized noiseless case of \cref{eq:pl.phase_retrieval_measurements}, i.e.\ $\epsilon\ind{l} = 0$.
Then, we can reconstruct $\ketbra{x}$ using the following rank-minimization problem
\[
  \begin{split}
    \underset{{Z}}{\textrm{minimize}} &\quad \rank Z \\
    \textrm{subject to} &\quad  \tr\left( \ketbra{\alpha\ind{l}} \, Z \right) = y_l \quad (l=1,\ldots,m)
  \end{split}
  \label{eq:pl.rank_minimization}
\]
provided $m$ is sufficiently large to single out $\ketbra{x}$.
However, rank minimization is $\NP$-hard in general~\cite{Boyd}, and therefore, \cref{eq:pl.rank_minimization} cannot be solved efficiently.
Nevertheless, there are algorithms for recovering $\ketbra{x}$ that are computationally efficient with only a slight overhead in the number of measurements required.
Here, we consider the following convex algorithm termed \emph{PhaseLift}~\cite{Candes_2013_Phaselift}
\[
  \label{eq:pl.PhaseLift}
  \begin{split}
    \underset{{Z}}{\textrm{minimize}} & \quad \sum_{l=1}^m \left| \tr \left( \ket{\alpha^{(l)}} \bra{\alpha^{(l)}} \, {Z} \right) - y^{(l)} \right| \\
    \textrm{subject to} &\quad  {Z} \geq 0. \nonumber
  \end{split}
\]
From the minimizer $Z^\sharp$ of \cref{eq:pl.PhaseLift}, we obtain the recovered signal vector ${ x}^\sharp$ as follows:
Consider the eigenvalue decomposition of $Z^\sharp$
\[
  Z^\sharp = \sum_i \lambda_i \ketbra{z_i}
\]
with $\ltwonorm{z_i} = 1$ and $\lambda_1 \ge \lambda_2 \ge \ldots \lambda_n$.
Then, we set
\[
  x^\sharp = \sqrt{\lambda_1} y_1.
\]

Several analytic proofs of convergence have been established for phase retrieval via PhaseLift.
With few notable exceptions~\cite{Kech_2016_Explicit}, these are probabilistic in nature and assume that each measurement vector is chosen from an appropriate distribution.
Paradigmatic examples are the Gaussian and the uniform (spherical) measurement ensemble~\cite{Candes_2013_Phaselift}.
In case of the Gaussian ensemble, the components $\alpha\ind{l}_i$ of the measurement vectors are i.i.d.\ complex Gaussian random variable.
In the uniform scheme, the $\alpha^{(l)}$ are chosen uniformly from the complex unit sphere.
The two are highly related, as the latter arises by normalizing all Gaussian vectors to a fixed value.
However, these two measurement examples are often unsuitable for practical applications, which led to a large body of work proving similar recovery guarantees  for measurement ensembles that feature less randomness~\cite{Gross_2014_Partial,Kueng_2014_Low,Kueng_2014_Low,Kueng_2016_Low} or additional structure tailored to specific applications~\cite{Candes_2013_Phaselift,Gross_2017_Improved,Voroninski_2013_Quantum,Kueng_2015_Low}.

The main theoretical contribution of this chapter is such a recovery guarantee for a measurement ensemble motivated by the experimental architecture of linear optical devices:
The \emph{randomly erased complex Rademacher} (RECR) ensemble requires only four phase shifter settings per mode, and hence, is easier to implement experimentally than e.g.\ the uniform ensemble, which necessitates the ability to prepare any phase shift.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Theory for Characterization via PhaseLift}


\subsection{The RECR ensemble}

The uniform ensemble mentioned above is well-suited for a theoretical analysis.
This sampling scheme places high demands on the experimental implementation since it necessitates the ability to prepare any coherent input state $\ket{ \alpha}$ with $\alpha$ from the complex unit sphere.
Therefore, we propose an alternative measurement ensemble that lends itself to implementations in linear optics:
For $p \in [0,1]$, we define a \emph{randomly erased complex Rademacher} (RECR) random variable $a$ to be distributed according to
\[
  a \sim
  \begin{cases}
    \pm 1, \pm \ii & \textrm{each with prob. } p/4 \\
    0 & \textrm{with prob. } 1 - p.
  \end{cases}
  \label{eq:pl.recr_definition}
\]
For the RECR measurement model, we sample the components $\alpha_k$ of the input state $\ket{ \alpha}$ according to \cref{eq:pl.recr_definition}, but with constant total intensity $\norm{\alpha} = 1$.
Since there are only four different values for the phases of the components~\eqref{eq:pl.recr_definition}, the RECR scheme is easier to implement experimentally as described below.

\begin{itemize}
\item \emph{Isotropy on $\mathbb{C}^n$:}
\[
  \mathbb{E} \left[ | \langle \alpha,  z \rangle |^2 \right] = C_I \|  z \|_{\ell_2}^2 \quad \forall  z \in \mathbb{C}^n.
  \label{eq:tight_frame}
\]

\item \emph{Sub-Isotropy on $\Hermitian_n$}:
\begin{align}
  \mathbb{E} \left[ \langle \alpha |  Z | \alpha \rangle^2 \right] \geq C_{SI} \|  Z \|_2^2 \quad \forall  Z \in \Hermitian_n \label{eq:sub_isotropy}
\end{align}

\item \emph{Sub-Gaussian tail behaviour:} For every normalized $ z \in \mathbb{C}^n$ ($\|  z \|_{\ell_2}=1$), $| \langle \alpha,  z \rangle|$ is sub-Gaussian in the sense that its moments obey
\[
  \mathbb{E} \left[ | \langle \alpha,  z \rangle|^{2N} \right] \leq C_{SG} N! \quad N \in \mathbb{N}.
\label{eq:subexponential}
\]
\end{itemize}


\begin{proposition}%
  \label{prop:gauss+recr_requirements}
  The following measurement ensembles fulfil the three properties above:
  \begin{enumerate}

    \item \emph{Gaussian sampling scheme:} $\alpha \in \mathbb{C}^n$ is chosen from the standard complex normal distribution $\mathcal{N}(0,\tfrac{1}{2}\mathbb{I})+ i \mathcal{N}(0,\tfrac{1}{2}\mathbb{I})$. In this case
  \[
    C_I = C_{SI} = C_{SG} = 1.
  \]

  \item \emph{Uniform sampling scheme:} $\alpha \in \mathbb{C}^n$ is a vector chosen uniformly from the complex unit sphere with radius $\sqrt{n}$. In this case
  \[
    C_I = 1, \; C_{SI} = \frac{n}{n+1}, \; C_{SG} = \prod_{k=1}^{N-1} \frac{n}{n+k} \leq 1.
  \]

  \item (unnormalised) \emph{Randomly Erased Complex Rademacher (RECR) sampling scheme:} with respect to a fixed (arbitrary) basis, the coefficients of $\alpha \in \mathbb{C}^n$ are chosen from the following distribution:
  \[
  \alpha_i \sim
  \begin{cases}
  +1 & \textrm{with prob. } p/4 \\
  +\ii & \textrm{with prob. } p/4 \\
  0 & \textrm{with prob. } 1-p \\
  -\ii & \textrm{with prob. } p/4 \\
  -1 & \textrm{with prob. } p/4 \\
  \end{cases}
  \label{eq:definition_recr}
  \]
  %Finally, $a$ is normalized to length $\sqrt{n}$ to assure constant intensity.
  The constants depend on the erasure probability $1-p \in [0,1]$:
  \[
  C_I = p,\; C_{SI} = p \min \left\{p,1-p \right\}, \; C_{SG} = \mathrm{e}^{\frac{3}{2}}.
  \]
  \end{enumerate}
\end{proposition}


The proof techniques developed here do not apply to the normalized RECR scheme presented in the main text.
We comment on potential extension to this case in \cref{sec:pl.normalized_recr}.\\



We now turn to the problem of proving recovery guarantees for PhaseLift with inputs sampled from distributions satisfying the conditions stated above.
The following statement is a substantial generalization of existing results regarding phase retrieval from Gaussian and uniform measurements~\cite{candes_solving_2012,demanet_stable_2014}:

\begin{theorem}[Theorem 1.3 in~\cite{candes_solving_2012}]%
  \label{thm:phaselift_noisy}
  Suppose that $m = Cn$ vectors $\alpha_1,\ldots,\alpha_m \in \mathbb{C}^n$ have been chosen independently at random from an ensemble that obeys the three properties \eqref{eq:tight_frame}, \eqref{eq:sub_isotropy} and \eqref{eq:subexponential}.
  Then, with probability at least $1 - 3\mathrm{e}^{-\gamma m}$,  $m$ noisy measurements of the form~\eqref{eq:guarantee.measurements} suffice to reconstruct any ${x} \in \Complex^n$ via PhaseLift -- the convex optimization problem~\eqref{eq:guarantee.phaselift}.
  This reconstruction is stable in the sense that the minimizer ${X}^\sharp$ of \cref{eq:guarantee.phaselift} is guaranteed to obey
  \[
    \left\| {X}^\sharp - |{x} \rangle \! \langle {x}| \right\|_2 \leq \frac{C'  \| \epsilon \|_{\ell_1}}{m}. \label{eq:noisy_recovery_bound}
  \]
Here, $\| \cdot \|_2$ denotes the Hilbert-Schmitt norm $\| {Z} \|_2^2 = \tr \left( {Z} {Z}^\dagger \right)$, while $C,C'$ and $\gamma$ represent constants of sufficient size.
\end{theorem}

The constants $C,C',\gamma$ implicitly depend on $C_I,C_{SI}, C_{SG}$ in \eqref{eq:tight_frame}, \eqref{eq:sub_isotropy}, \eqref{eq:subexponential} and can in principle be extracted from the proof.
No attempt has been made to optimize them.
Note that the demand on the number of measurements $m$ in \cref{thm:phaselift_noisy} scales linearly in the problem's dimension $n$.
This is optimal up to the constant multiplicative factor $C$.
Analytical bounds on this constant $C$ are usually too pessimistic to be practical and it is widely believed that
\(
  m = 4n - 4
\)
such measurements are actually sufficient, that is $C = 4 + o(n)$~\cite{heinosaari_quantum_2013}.
We refer to~\cite{MixonBlog} for further information about this topic.


We postpone the proof of this result to \cref{sec:pl.main_proof} in order to derive an error bound for the signal vector from \cref{thm:phaselift_noisy}.
Recall that we obtain the recovered signal vector ${x}^\sharp$ from the minimizer ${X}^\sharp$ of \cref{eq:guarantee.phaselift} by a eigenvalue decomposition.
Let
\[
  {X}^\sharp = \sum_i \lambda_i \ket{ x_i}\bra{ x_i}
\]
with $\lambda_1 \ge \lambda_2 \ldots \ge \lambda_n$.
Then, we set
\[
  {x}^\sharp = \sqrt{\lambda_1}  x_1.
\]
In~\cite{candes_solving_2012} it was shown that \cref{eq:noisy_recovery_bound} implies
\[
  \min_{0 \leq \phi \leq 2 \pi} \, \| {x}^\sharp - \mathrm{e}^{\ii \phi} {x} \|_{\ell_2}
  \leq C'' \frac{\| \epsilon \|_{\ell_1} }{m \| {x} \|_{\ell_2}}
, \label{eq:vectorial_noisy_bound}
\]
where $C''$ again denotes an absolute constant.



\subsection{Characterization via PhaseLift}

Let us now turn to connecting the two problems introduced in the last section, namely determining the transfer matrix ${M}$ of a linear optical device on one hand and phase retrieval on the other hand.
Note that the measured intensity at detector $j$ as given by \cref{eq:pl.intensities} exclusively provides us with information about the $j$-th row vector of ${M}$:
\[
  I_j({\alpha})
  = \left| \sum_{k=1}^n M_{j,k} \alpha_k \right|^2 + \epsilon_j
  = \left\vert  \langle {M}_j, \alpha \rangle  \right\vert^2 + \epsilon_j. \quad 1 \leq j \leq n
  \label{eq:pl.intensities_as_overlap}
\]
Here, we have defined ${M}_j$ as the (complex conjugated) row vectors of ${M}$.
Since the measured intensities in \cref{eq:pl.intensities_as_overlap} exactly resemble the measurement model of the phase retrieval problem in \cref{eq:pl.phase_retrieval_measurements}, we can use the ideas mentioned in the introduction to reconstruct the transfer matrix.
For this we propose the following protocol:
\begin{protocol}{(for recovering the transfer matrix $ M$)}%
  \label{prot:characterization}
  \begin{enumerate}
    \item Sample $m$ random coherent input states $\ket{ \alpha^{(l)}}$ from an appropriate ensemble.
    \item Measure the $m \times n$ intensities $I_1(\alpha^{(l)}), \ldots, I_n ( \alpha^{(l)})$ with $l=1,\ldots,m$.
    \item Use PhaseLift~\eqref{eq:pl.PhaseLift} to recover each ${M}_j$ individually.
  \end{enumerate}
\end{protocol}
Two important questions remain:
(i) from which ensemble should we sample the input coherent states and (ii) how many such inputs are sufficient for a successful reconstruction?
In this section we provide two different answers to these questions.
First, we show that the established uniform measurement ensemble~\cite{Kueng_2014_Low} allows for reconstructing $ M$ from an asymptotically optimal number of measurements.
Second, we introduce a new sampling scheme tailored to the specific application.
While the latter is easier to implement experimentally, it provably performs as well as the uniform ensemble.\\


One important theoretical contribution of this work is to provide a rigorous proof of convergence for the proposed reconstruction scheme, which we outline now.
We refer the reader to the supplemental material for an exact formulation and the proofs.
\begin{theorem}[Informal version]%
  \label{thm:performance_guarantee}
  Suppose that $m \geq Cn$ coherent input states have been chosen from either the uniform or the RECR ensemble.
  Then, with high probability, any transfer matrix ${M}$ can be reconstructed via \cref{prot:characterization}.
\end{theorem}
%For the exact definitions as well as more details see the supplemental material.

This statement is to be understood as a theoretical performance guarantee in terms of an upper bound on the reconstruction error
\(
  \min_{{\mu}}\left\| {M}^\sharp -  {D} ({\mu}) {M}) \right\|_2.
\)
Here, ${M}^\sharp$ is the reconstruction and ${D}(\mu) = hrm{diag}(\mu_1, \ldots, \mu_n)$ with $\abs{\mu_j} = 1$ are the row-phases of ${M}$ that cannot be  recovered from the measurements~\eqref{eq:pl.intensities}.
Our proofs do not give a tight bound for the constant $C$.
The numerical simulations reported on below show that, roughly, $C\simeq 4$.
%The constant $C$ -- while being bounded and in principle retrievable from the proofs -- is very unlikely to be optimal.
%This is why we run numerical simulations in the following section in order to determine a practical value of $C$ which is conjectured to be 4.
% Arriving at the robust recovery guarantee for ${M}$ in the presence of additive noise is arguably one of the advantages of using phase retrieval techniques.



Now, let us investigate the consequences of \cref{thm:phaselift_noisy} to our problem of characterising linear optical networks.
In \cref{eq:intensities_as_overlap}, we have already underlined the similarity between the intensity measurements in our setup on one hand and the assumed measurements~\eqref{eq:guarantee.measurements} for the phase retrieval on the other hand.
The input vector ${\alpha}$ acts as a measurement vector and each row of the transfer matrix ${M}_j$ plays the role of a complex signal vector $ x$ to be determined.
\Cref{thm:phaselift_noisy} now allows for recovering these row vectors individually by means of the PhaseLift algorithm~\eqref{eq:guarantee.phaselift}.
In order to meet the requirements for recovering the first row of ${M}$ using \cref{thm:phaselift_noisy}, we have to measure the intensities in the first output mode $I_1(\alpha^{(l)})$ for $m = Cn$ random coherent input states $\ket{{\alpha}^{(1)}}, \ldots \ket{{\alpha}^{(m)}}$ sampled from a distribution fulfilling the conditions \eqref{eq:tight_frame}, \eqref{eq:sub_isotropy} and \eqref{eq:subexponential}.
Said theorem then guarantees recovery of ${M}_1 \in \Complex^n$ -- the complex conjugate of the first row of $ M$ with high probability by means of PhaseLift \eqref{eq:guarantee.phaselift}.
Before we can move on to determine the remaining row vectors ${M}_{j}$ ($2 \leq j \leq n$) of ${M}$, it is important to point out that the recovery guarantee of \cref{thm:phaselift_noisy} is \emph{universal}: one instance of randomly chosen measurement vectors suffices to recover \emph{any} vector ${x} \in \Complex^n$.
In our particular setting, this universality assures that a single choice of random coherent states $\ket{{\alpha}^{(1)}},\ldots,\ket{{\alpha}^{(m)}}$ suffices to recover all row vectors ${M}_j$ simultaneously.

In this section we are going to proof the performance guarantee for reconstructing transfer matrices for the uniform sampling scheme.
Although \cref{thm:phaselift_noisy} also applies to the RECR scheme, we are only going to consider the uniform scheme in this section.
The reason for this is that our application requires scaling the input vectors to constant norm $\norm{\alpha} = 1$.
However, we currently have no proof of \cref{prop:gauss+recr_requirements} for a normalised RECR version.
Instead, we will show in \cref{sec:pl.normalized_recr} how to deal with normalised RECR vectors.

\begin{protocol}[\emph{Reconstruction of the transfer matrix ${M}$}]%
  \label{prot:detailed_reconstruction}
  Let ${M}$ be an arbitrary $n \times n$ transfer matrix as defined in~\eqref{eq:coherent_transfer_matrix}.
  In order to approximately recover it, sample $m = Cn$ random coherent input states $\ket{{\alpha}^{(1)}},\ldots,\ket{{\alpha}^{(m)}}$ uniformly from the unit complex sphere and measure the $mn$ intensities
  \[
    y_j^{(l)} = \left| \sum_i M_{j,i} \, \alpha_i^{(l)} \right|^2 + \epsilon_j^{(l)} \quad \forall 1 \leq j \leq n, \quad 1 \leq l \leq m,
  \]
  where $\epsilon_j^{(l)}$ denotes the additive noise at detector site $j$ when measuring the intensity resulting from input state  $\ket{{\alpha}^{(l)}}$.
  For each $1 \leq j \leq n$, solve the semi-definite program
  \begin{align}
    {Z}^\sharp_{j} = \underset{{Z} \in \Hermitian_n}{\argmin}& \quad \sum_{l=1}^m \left| \tr \left( (|{\alpha}^{l} \rangle \langle {\alpha}^{(l)} | )  Z \right) - y_j^{(l)} \right| \label{eq:tmat_recovery_program}\\
    \mathrm{s.t.} & \quad {Z} \geq 0 \nonumber
  \end{align}
  and let ${M}_j^\sharp$ be the eigenvector of ${Z}^\sharp_{j}$ corresponding to its largest eigenvalue and rescaled to have length $\norm{{M}_j^\sharp}_{\ell_2} = \sqrt{ \| {Z}^\sharp_{j} \|_\infty}$.
  Then, the we estimate ${M}$ by
  \[
    {M}^\sharp =
    \begin{pmatrix}
      \adj{{M^\sharp}_1} \\ \vdots \\  \adj{{M^\sharp}_n}
    \end{pmatrix}.
    \label{eq:transfermat_estimator}
  \]
\end{protocol}
Note that \cref{eq:transfermat_estimator} simply amounts to stacking the separately recovered row vectors $ M_j^\sharp$.
The additional complex conjugation by taking the adjoint is due to the definition of $ M_j$ below \cref{eq:intensities_as_overlap}.

Now, a simple extension of \cref{thm:phaselift_noisy} yields a similar performance guarantee for \cref{prot:detailed_reconstruction}.
In order to succinctly state this result, we introduce some additional notation.
Define the total noise at detector site $j$ (measured in $\ell_1$-norm) to be
\[
  \epsilon_j^{\mathrm{tot}}= \sum_{l=1}^m \abs{\epsilon_j^{(l)}}
\]
and the overall noise strength:
\[
  \epsilon^{\mathrm{tot}} = \sqrt{ \sum_{j=1}^n {\epsilon_j^{\mathrm{tot}}}^2}.
\]


\begin{corollary}[Performance guarantee for \cref{prot:detailed_reconstruction}]
  \label{cor:noisy_performance_guarantee}
  The reconstruction ${M}^\sharp$ of any transfer matrix ${M}$ by means of \cref{prot:detailed_reconstruction} satisfies
    % Moreover, the error in reconstruction each row ${M}_j$ of the transfer matrix is -- up to a global phase -- bounded by
    % \[
    %   \min_{0 \leq \phi \leq 2 \pi}\left\| {M}_j^\sharp - \mathrm{e}^{i \phi} {M}_j \right\|_{\ell_2} \leq C' n \min
    %   \left\{
    %   \| {M}_j \|_{\ell_2}, \frac{ \epsilon_j^{\mathrm{tot}}}{m \| {M}_j \|_{\ell_2}}
    %   \right\}.
    %   \label{eq:noisy_reconstruction_vectorial_bound}
    % \]
  % This in turn implies the overall reconstruction bound
    \[
      \min_{{\mu}: \abs{\mu_j} = 1} \left\|  {M}^\sharp -  {D} ({\mu}) {M} \right\|_2
      \leq C' \frac{n \epsilon^\mathrm{tot}}{m \nu}.
      \label{eq:noisy_reconstruction_total_bound}
    \]
  with high probability (i.e.\ with probability at least $1 - \Order \left( \mathrm{e}^{-\gamma m}\right)$).
  %  on the error in reconstructing the physically relevant part of $M$ by means of~\eqref{eq:transfermat_estimator}.
  Here, $C'$ is a constant of sufficient size and
  \[
    \nu = \min_{1 \leq j \leq n} \| {M}_j \|_{\ell_2}.
    \label{eq:definition_normconst}
  \]
\end{corollary}
Recall that ${D}(\mu) = \mathrm{diag}(\mu_1, \ldots, \mu_n)$ with $\abs{\mu_j} = 1$ are the row-phases of ${M}$ unrecoverable from the measurements~\eqref{eq:intensities}.
Note that $\nu = 1$ for unitary transfer matrices and $\nu < 1$ if there is loss.

\begin{proof}
For any fixed row vector ${M}_j$,
\[
  \min_{0 \leq \phi \leq 2 \pi}\left\| {M}_j^\sharp - \mathrm{e}^{i \phi} {M}_j \right\|_{\ell_2} \leq C' n \min
  \left\{
  \| {M}_j \|_{\ell_2}, \frac{ \epsilon_j^{\mathrm{tot}}}{m \| {M}_j \|_{\ell_2}}
  \right\}.
  \label{eq:noisy_reconstruction_vectorial_bound}
\]
follows directly from \cref{thm:phaselift_noisy}.
Note that the additional $n$ factor compared to \cref{eq:vectorial_noisy_bound} is due to the normalisation of the input vectors.
As shown in \cref{prop:gauss+recr_requirements}, the input vectors sampled uniformly from the complex unit sphere need to be scaled by $\sqrt{n}$ in order to satisfy Eqs.~\eqref{eq:tight_frame}--\eqref{eq:subexponential}.
Universality (one choice of phaseless measurements allows for reconstructing any vector) moreover allows for applying this reconstruction guarantee to all $n$ row vectors ${M}_j$ simultaneously.

The total noise bound~\eqref{eq:noisy_reconstruction_total_bound} follows from the entry-wise definition of the Frobenius norm:
  \begin{align}
    \min_{{\mu}}\left\|  {M}^\sharp -  {D} ({\mu}) {M} \right\|_2 ^2
    % &= \min_{0 \leq \phi_1,\ldots,\phi_n \leq 2 \pi}
    % \left\| \sum_{j=1}^n |{b}_j \rangle \left( |{M}_j^\sharp \rangle - \mathrm{e}^{i \phi_j} | {M}_j \rangle \right) \right\|_2^2  \\
    &= \min_{0 \leq \phi_1,\ldots,\phi_n \leq 2 \pi}
    \sum_{j=1}^n \left\| {M}_j^\sharp - \mathrm{e}^{i \phi_j} {M}_j \right\|_{\ell_2}^2 \\
    &= \sum_{j=1}^n \min_{0 \leq \phi_j \leq 2 \pi} \left\| {M}_j^\sharp - \mathrm{e}^{i \phi_j} {M}_j \right\|_{\ell_2}^2 \\
    & \leq (C')^2 n^2 \sum_{j=1}^n  \min \left\{ \| {M}_j \|_{\ell_2}^2, \frac{ \eta_{(j)}^2}{m^2 \|{M}_j \|_{\ell_2}^2} \right\} \\
    &\leq \left(C' n\right)^2 \sum_{j=1}^n \frac{\eta_{j}^2}{m^2 \|{M}_j \|_{\ell_2}^2} \\
    & \leq \frac{\left(C'n \right)^2}{m^2 \nu} \sum_{j=1}^n \eta_{j}^2 \\
    &= \left( C' n \frac{\eta^{\mathrm{tot}}}{m \nu} \right)^2,
  \end{align}
 Here, we have used \eqref{eq:vectorial_noisy_bound} for each summand in the third line.
  Taking the square root then yields the desired expression. % because the square root is a monotonous function and, thus, does not affect the inequalities above.
\end{proof}
Note that this formulation allows to treat the different output modes and their detector noise levels individually.
In particular, we do not require a universal type of noise for all detectors, but allow for taking into account detector dependent noise of different quality (i.e.\ varying noise levels).



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}
\subsection{Numerical Results}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure*}[tbp]
  \begin{subfigure}{.475\columnwidth}
    \includegraphics[width=\linewidth]{fig/phaselift_sim_gaussian}
    \caption{\label{sfig:simplot.gaussian}%
      Uniform sampling
    }
   \end{subfigure}
  \begin{subfigure}{.475\columnwidth}
    \includegraphics[width=\linewidth]{fig/phaselift_sim_recr}
    \caption{\label{sfig:simplot.recr}%
      RECR sampling
    }
   \end{subfigure}
  \caption{\label{fig:simplot}%
    Simulated recovery-probability using the two different sampling schemes under noisy measurements with $\sigma = 0.05$.
    For each given dimension, the transfer matrices to be recovered consist of 97 Haar random unitaries as well as the identity, the swap-matrix, and the discrete Fourier transform.
    The red line indicates the conjectured phase transition at $4 n - 4$.
  }
\end{figure*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We demonstrate the practical applicability of the PhaseLift characterisation protocol using simulated experiments.
The simulation depicted in \cref{fig:simplot} aims to visualize the performance guarantees from \cref{thm:performance_guarantee}:
For each given dimension $n$, we choose 100 target unitaries.
Each of these is reconstructed by means of \cref{prot:characterization} with a varying number of measurements $m$.
The input vectors are sampled from the uniform ensemble in \cref{sfig:simplot.gaussian} and from the RECR ensemble in \cref{sfig:simplot.recr}.
For the measurement noise $\epsilon_j$ from \cref{eq:pl.intensities_as_overlap}, we assume independent, centred Gaussian noise with standard deviation $\sigma = 0.05$.
The density plots show the fraction of successfully recovered unitaries.
Here, the criterion for success is whether the distance of the reconstruction $M^\sharp$ measured in Frobenius norm is smaller than the threshold  $4 \sigma n$ in accordance with the error bound from \cref{cor:noisy_performance_guarantee} in the supplemental material.

Figs.~\ref{sfig:simplot.gaussian} and \ref{sfig:simplot.recr} show a pronounced phase transition around $4n - 4$.
This demonstrates the high efficiency of \cref{prot:detailed_reconstruction} with respect to the number of measurements.
Not only does the number of measurements scale linearly in the system size but the scaling coefficient is small as well.



\subsection{Experimental Implementation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure*}[tbp]
  \centering
  \includegraphics[width=0.95\columnwidth]{fig/phaselift_schematic}%
  \caption{%
    Schematic of phaselift characterisation protocol and experiment.
     a) Protocol summary (see \cref{prot:characterization}).
     A calibrated and trusted network is used to prepare multimode coherent states $\singleket{\boldsymbol{\alpha}}$, sampled from the uniform or RECR ensembles.
     This state is then input to an unknown linear optical device described by the transfer matrix $ M$, and the intensities at each output port are measured.
     b) Experimental schematic.
     Heralded single photons are input into the bottom waveguide of a six-mode integrated photonic device.
     A cascade of Mach-Zehnder interferometers is used to prepare single-photon states $\singleket{\psi( \alpha)}$ over the bottom five modes of the device.
     The remainder of the device is used to implement arbitrary 2, 3 and 5 dimensional unitary transformations which are to be characterised.
     Each output port is coupled to a single photon detector.
   }
  \label{fig:experimental.schematic}
\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure*}[tbp]
  \centering
  \includegraphics[width=0.95\textwidth]{fig/phaselift_ex_dipsref}
  \caption{%
     \label{fig:experimental.overview}
     Comparing reconstructions from experimental data for different target transfer matrices and sampling schemes.
     For each matrix and sampling scheme, we subsample $m = 5n$ preparation vectors and the corresponding measured intensities from the experimental data 100 times.
     The coloured diamonds indicate the median and the coloured area sketches the distribution of the discrepancy between the PhaseLift reconstruction and an alternative method.
     Since for $n=2$ there are only six distinct RECR vectors up to a global phase, there is only one reconstruction.
     In the left picture, the reference is obtained through a HOM-dip reconstruction as discussed in the appendix.
     However, since this technique is too costly for larger dimensions, the five dimensional reconstructions on the right are only compared in magnitude to a reference from single photon data neglecting all phase information.
     For more details on the data analysis see the supplemental material.
  }
\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure*}[tbp]
  \centering
  \includegraphics[width=\columnwidth]{fig/phaselift_ex_targetref}
  \caption{%
     \label{fig:experimental.targetref}
     Same as \cref{fig:experimental.overview}, but the reconstructions are compared to the theoretical target unitaries.
     \quotes{HOM-dip} refers to the reconstructions used as references in \cref{fig:experimental.overview}.
     We do not show the results for the 5 dimensional unitaries since the corresponding HOM-dip reconstructions were too costly to take.
  }
\end{figure*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \begin{figure*}[tbp]
%   \centering
%   \includegraphics[width=0.95\columnwidth]{fig/ex_details}
%   \caption{%
%     \label{fig:experimental.details}
%    Reconstruction errors for a random $5 \times 5$ matrix from experimental data.
%    For each picture, we plot the mean (solid) as well as min- and max- errors over 25 samples.
%    In the left picture, each sample consists of a recovery from $m$ preparation vectors and the corresponding photon counts measured over $t = 30\,hrm{s}$
%    In the right picture, we fix a randomly selected set of $m=20$ preparation vectors and run the recovery with the photon counts from $t$ randomly selected time bins, each of which is one second long.
%   }
% \end{figure*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

To demonstrate its practical utility, we used our protocol to perform experimental characterisations of a reconfigurable integrated photonic circuit.
The silica-on-silicon device performs a linear-optical circuit comprising 30 directional couplers and 30 tunable thermo-optic phase-shifters on six optical waveguides \cite{Carolan_2015_Universal}.
As shown in \cref{fig:experimental.schematic}, inputting coherent light into the bottom waveguide of the device, an initial cascade of five Mach-Zehnder interferometers (MZIs) and accompanying phase-shifters can be used to prepare any five-mode input vector $\ket{{\alpha}}$.
The remaining triangular array of components is then sufficient to implement any five mode unitary transfer matrix $M$~\cite{Reck_1994_Experimental}.
Reconfiguring the target $M$ then enables us to experimentally test the protocol across a number of configurations including Identity, Swap, and Fourier matrices as well as Haar random unitaries.
One advantage of the RECR scheme over the uniform scheme becomes clear from~\cref{fig:experimental.schematic}:
Since the RECR scheme only requires four different phase values in each mode, these configurations can be calibrated more precisely.
In contrast, for the uniform scheme the preparation stage needs to be able to prepare any phase shift in each mode, and therefore, it is much more demanding for the experiment.

Although, as we have described, the protocol can be performed using coherent states and photodiodes, for this experimental demonstration we instead use heralded single photons and single photon detectors.
This is because the properties of the components and, therefore $ M$ are generally mode-dependent, that is dependent on the wavelength, polarisation, etc.\ of the light.
Since it is the goal to characterise the device for quantum experiments, the most accurate characterisation for this purpose is achieved using the same mode of light used in the future quantum experiments. .
When a single photon Fock state is input in the bottom waveguide, the prepared state prior to $ M$ is
\[
  \ket{\psi({\alpha})} = \sum_k \alpha_k a_k^{\dag} \ket{hfrak{0}}
\]
where $\ket{hfrak{0}}$ denotes the vacuum state.
The transfer matrix $M$ performs the mapping $a_k^{\dag} \rightarrow \sum_j M_{j,k}a_j^{\dag}$.
The probability of measuring the photon at detector $j$ is then given by
\[
  hbb{P}(j|{\alpha}) = \left| \sum_k M_{j,k} \alpha_k \right|^2.
  \label{eq:pl.experiment.probabilities}
\]
Hence, finite-sample frequency estimates of the probabilities~\eqref{eq:pl.experiment.probabilities} are equivalent to the noisy intensity measurements~\eqref{eq:pl.intensities}.
In the experiment, a spontaneous parametric down-conversion process is used to produce a heralded single photon via the detection of its correlated pair photon in the idler mode.
The photon is coupled into and out of the photonic chip via optical fibre and all output modes are simultaneously measured by an array of single photon avalanche photodiodes.
For all $ M$ of the same size, data is collected for the same set of randomly chosen input vectors.
For more details on the experimental setup and the data analysis, see the supplemental material.\\



\subsection{Experimental Results}
In \cref{fig:experimental.overview}, we show the discrepancy of the PhaseLift recoveries compared to another experimental reconstruction.
The number of input vectors used in each reconstruction is $m = 5n$.
This slight overhead compared to the numerically conjectured phase transition in \cref{fig:simplot} is used to counteract systematic errors in the generation of the random vectors, which we conjecture to be the main source of error in this experiment.
Since our aim is to benchmark the performance of the PhaseLift characterisation, and not the performance of the chip itself, we compare to reconstructions obtained through established but more costly techniques: for the smaller transfer matrices of dimension two and three, we perform a complete HOM-dip-reconstruction based on two photon interference (see supplemental material).
However, since this is infeasibly costly for the five-dimensional transfer matrices, we only compare these to single-photon reconstructions of the absolute values of the transfer matrix components.
Therefore, for the larger transfer matrices, we neglect the phase information of the reconstruction.

We see that the PhaseLift reconstructions and the references agree well for most settings.
Even without exploiting the possible advantages of the RECR scheme due to a better calibration, it generally performs as well as the uniform sampling scheme.
Both display a similar behaviour: for a fixed number of modes, the deviations are generally larger for the random unitaries compared to the more structured identity and Fourier transfer matrices.
Also, the errors for the two-dimensional transfer matrices are slightly smaller than for the corresponding three-dimensional transfer matrices.
In general, we expect larger deviations with an increase in the size of the transfer matrix, since errors in the phases of the components accumulate in the reference reconstructions.
Furthermore, the currently used sequential arrangement of the MZIs in the preparation stage of the experiment also leads to higher reconstruction errors with an increase in dimension -- possible solutions to this problem are discussed in the conclusions.
Note that the errors for the five-dimensional transfer matrices are relatively small since they only take into account the absolute values of the components and neglect all phases.

In \cref{fig:experimental.targetref} we compare the performance of the PhaseLift reconstruction to the HOM-dip reconstruction.
In contrast to \cref{fig:experimental.overview}, here we use the theoretical target unitary as a reference.
Generally, the errors of the PhaseLift reconstructions and the HOM-dip reconstructions are of the same order of magnitude.
This is despite the fact that the HOM-dip reconstruction is not just insensitive to the row phases, but also to the column phases.
Therefore, the reported errors for the HOM-dip reconstruction are minimised over $2n$ phases instead of just $n$ phases for the PhaseLift reconstruction.
The additional free parameters in the minimisation may lead to overfitting, and hence, to an underestimation of the actual error of the HOM-dip reconstruction.
For more details, please see the supplemental material.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusion and Outlook}

In this work, we introduce a solution to the problem of characterising linear optical devices based on recent advances in phase retrieval and low-rank matrix recovery.
The PhaseLift reconstruction outlined in \cref{prot:characterization} can be used to reconstruct any transfer matrix using only intensity measurements and classical states of light as inputs, which are chosen at random from an appropriate ensemble.
Not only do the number of measurements required for this approach scale linearly in the number of modes of the device, the theory behind it also provides stringent error bars for the reconstruction.
As the major contribution of this work, we proof recovery guarantees for the RECR ensemble, which is especially suited for the application in linear optical devices.
We also report on a successful experimental implementation of the PhaseLift characterisation protocol based on a universally reconfigurable six waveguide device.
The results from this experiment show that although the experimental effort of our approach is much lower, it provides a similar performance compared to other characterisation techniques.

\todo[inline]{@Bristol: Your future work?}
Another possible extension of the experimental work is the development of a dedicated state-preparation circuit.
In the current architecture, possible errors in the preparation state for the coherent state inputs $\ket{\alpha}$ add up linearly due to the serial wiring in the preparation stage.
With a tree-like arrangement of the directional couplers, we might be able to also benefit from the fact that the RECR scheme allows only for two possible values for the intensity of each input mode $\abs{\alpha_i}$.
